@page
@using QuestionPool.Models
@model QuestionPool.Pages.question.DisplaySubjectiveQuestionModel
@{
    @functions {
        // Define the function to check if a question contains sub questions
        bool questionContainsSubQuestions(dynamic question)
        {
            // Add your logic here to check if the question contains sub questions
            // For example:
            // return question.Questions.Contains("(a)") || question.Questions.Contains("(b)") || question.Questions.Contains("(c)");
            return false; // Replace this with your actual logic
        }
    }
}
<head>
    <!-- plugin css -->
    <link href="~/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/libs/quill/quill.core.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/libs/quill/quill.bubble.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/libs/quill/quill.snow.css" rel="stylesheet" type="text/css" />

    <!-- Bootstrap Tables css -->
    <link href="~/assets/libs/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" type="text/css" />


    <!-- Theme Config Js -->
    <script src="~/assets/js/head.js"></script>

    <!-- Bootstrap css -->
    <link href="~/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" id="app-style" />

    <!-- App css -->
    <link href="~/assets/css/app.min.css" rel="stylesheet" type="text/css" />

    <!-- Icons css -->
    <link href="~/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    <script src="https://kendo.cdn.telerik.com/2023.1.425/js/kendo.all.min.js"></script>


    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/themes/6.3.0/default/default-ocean-blue.css">
    <script src="https://kendo.cdn.telerik.com/2023.1.425/js/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.3/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        html {
            background-color: white;
            font-size: 14px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .displayquestion-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .question-number {
            font-weight: bold;
            color: darkblue;
        }




        .question-item {
            cursor: move;
            border-bottom: 1px solid #dee2e6;
            padding: 10px; /* Change cursor to indicate draggable */
            font-size: 14px;
        }

        ul.answer-choices {
            list-style: none; /* 移除默认的 bullet point 样式 */
        }

            ul.answer-choices li::before {
                content: none; /* 隐藏自定义的 bullet point */
            }


        .answer-item {
            display: flex;
            align-items: center;
        }


        .answer-content {
            flex: 1; /* 让 answer-content 占据剩余的空间 */
        }

        .question-container {
            border-right:1px solid;
        }
/*         .question-mark-container {
            display: flex;
            align-items: center;
            margin-left: 150px;
            margin-top:80px;
            margin-right:30px
        } */


         /*    .question-mark-container::before {
                content: '';
                flex: 1;
                border-top: 2px dashed #ccc; 
                margin-right: 10px; 
            } */

        .question-marks {
            font-weight: bold;
            color: #333;
        }
    </style>
</head>
<body>
    <h1></h1>
    <div id="displayquestion-container" style="background-color: #f8f9fa; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);">

        <div class="col-12">
            <!-- Questions and Answers Container -->
            <div id="questions-answers-container">
                <!-- Questions List -->
                <div id="questions-list">
                    @foreach (var question in Model.Questions)
                    {
                        <div class="question-answer-container" style="display: flex; align-items: center;">
                         
                            <div class="col-10 question-container">
                                <div class="question-item" id="listed-question" data-question-id="@question.Id">
                                    <span class="drag-handle" style="font-size: 15px; cursor: grab;">&#9776;</span> @* <!-- Drag handle --> *@
                                    <div>
                                        <p class="question-title" style="margin-left: 20px;">
                                            @if (!question.Questions.Contains("(b)") && !question.Questions.Contains("(c)"))
                                            {
                                                <span class="question-number">@Html.Raw(question.QuestionNumber)</span>
                                            }
                                            <span style="font-weight: bold; color: #333; margin-left: 5px;">@Html.Raw(question.Name)</span>
                                            <br />
                                            <img src="@question.Image" class="img-fluid" asp-append-version="true" style="width:200px">
                                            <div class="question-text" style="margin-left: 40px;">@Html.Raw(question.Questions)</div>
                                        </p>
                                        <div class="question-mark-container" style="display: flex;align-items: center;margin-top:100px;justify-content:end">
                                            <div class="dashed-line" style="flex: 1;max-width: 140px; border-top: 2px dashed #ccc;margin-right: 10px;"></div>
                                            <span class="question-marks">@question.Mark marks</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @* <!-- Answers Section --> *@
                            <div class="col-2 answer-container" style="display: flex; align-items: center;justify-content:center">
                                <div class="answer-item">
                                    <div class="answer-content">
                                       @*  <!-- Answers part --> *@
                                        @if (question.QuestionAnswer.Any())
                                        {
                                            <ul style="padding-left: 40px; margin: 0;">
                                                @foreach (var answer in question.QuestionAnswer)
                                                {
                                                    <li>@answer.Answer</li>

                                                }
                                            </ul>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div style="display: flex;justify-content: space-between;margin-top:20px">
            <form id="pdfForm" method="post" asp-page-handler="ExportToPdf" target="_blank">
                <button id="exportQuestionsToPdf" class="btn btn-dark waves-effect waves-light" style="height:40px"><i class="mdi mdi-file-pdf-box"></i> Download Questions</button>
                <input type="hidden" name="questionsHtml" id="questionsHtml" value="">
            </form>
            <form id="pdfFormAnswers" method="post" asp-page-handler="ExportAnswersToPdf" target="_blank">
                <button id="exportAnswersToPdf" class="btn btn-dark waves-effect waves-light" style="height:40px">
                    <i class="mdi mdi-file-pdf-box"></i> Download Answers
                </button>
                <input type="hidden" name="answersHtml" id="answersHtml" value="">
            </form>
        </div>

    </div>

</body>


@section scripts {

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var sortable = new Sortable(document.getElementById('questions-list'), {
                animation: 150,
                handle: '.drag-handle',
                onEnd: function (evt) {
                    // 获取所有问题项
                    var questionItems = document.querySelectorAll('.question-item');
                    var normalQuestionNumber = 1;

                    // 遍历问题项，并重新设置问题编号
                    questionItems.forEach(function (item) {
                        var questionNumberElement = item.querySelector('.question-number');
                        var isFixed = item.getAttribute('data-fixed'); // 检查题目是否被标记为固定

                        // 如果题目不是固定的，并且不包含 (a), (b), (c)，重新设置普通题目的编号
                        if (isFixed !== 'true' && !item.textContent.includes('(b)') && !item.textContent.includes('(c)')) {
                            if (questionNumberElement) {
                                questionNumberElement.textContent = normalQuestionNumber + '.';
                                normalQuestionNumber++;
                            }
                        }
                    });
                }
            });
        });
        $(document).ready(function () {
            $("#exportQuestionsToPdf").off('click').on('click', function (e) {
                e.preventDefault();
                var htmlContent = '';
                var questionContainers = document.querySelectorAll(".question-container");
                questionContainers.forEach(function (container) {
                    htmlContent += container.innerHTML;
                });
                $("#questionsHtml").val(htmlContent);
                $("#pdfForm").submit();
            });

            $("#exportAnswersToPdf").off('click').on('click', function (e) {
                e.preventDefault();
                var htmlContent = '<table style="border-collapse: collapse; border: 1px solid black; width: 100%;text-align: center;">'; // Added width styling to the table
                htmlContent += '<tr><th style="border: 1px solid black;text-align: center;">No</th><th style="border: 1px solid black;text-align: center;">Answer</th><th style="border: 1px solid black;text-align: center;">Mark</th></tr>'; // Table headers with border
                var answerIndex = 1; // Initial index

                // 获取所有的 question-container
                var questionContainers = document.querySelectorAll(".question-container");
                questionContainers.forEach(function (container) {
                    var answer = container.nextElementSibling.querySelector(".answer-content ul").innerHTML; // 获取 answer
                    var mark = container.querySelector(".question-mark-container .question-marks").textContent; // 获取 mark

                    // 添加 answer、mark 和 index 到带有边框的表格行中
                    htmlContent += '<tr><td style="border: 1px solid black;">' + answerIndex + '</td><td style="border: 1px solid black;">' + answer + '</td><td style="border: 1px solid black;">' + mark + '</td></tr>';
                    answerIndex++;
                });
                htmlContent += '</table>';
                $("#answersHtml").val(htmlContent);
                $("#pdfFormAnswers").submit();
            });

        });

    </script>
}
<!-- Vendor js -->
<script src="~/assets/js/vendor.min.js"></script>
<!-- Plugins js -->
<script src="~/assets/libs/quill/quill.min.js"></script>

<!-- Init js-->
<script src="~/assets/js/pages/form-quilljs.init.js"></script>